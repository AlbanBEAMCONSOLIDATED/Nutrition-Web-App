<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="theme-color" content="#0B1220" />
  <title>Nutrition-Track</title>

  <link rel="manifest" href="manifest.webmanifest" />
  <link rel="stylesheet" href="styles.css" />

  <!-- PWA / iOS -->
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
</head>
<body>
  <div class="app" id="app">
    <header class="topbar">
      <div class="brand">
        <div class="logo" aria-hidden="true"></div>
        <div class="brand-text">
          <div class="brand-title">Nutrition-Track</div>
          <div class="brand-sub">Plan calories & macros en 30 secondes</div>
        </div>
      </div>

      <div class="controls">
        <div class="mode-toggle" role="group" aria-label="Mode">
          <button class="toggle" id="modeSimple" type="button">Simple</button>
          <button class="toggle" id="modeAdvanced" type="button">Avanc√©</button>
        </div>
      </div>
    </header>

    <main class="layout">
      <section class="form" aria-label="Formulaire">
        <div class="stepper" id="stepper" aria-label="√âtapes">
          <button class="step active" data-step="0" type="button">
            <span class="step-dot"></span><span class="step-label"><span class="full">Profil</span><span class="short">Profil</span></span>
          </button>
          <div class="step-line"></div>
          <button class="step" data-step="1" type="button">
            <span class="step-dot"></span><span class="step-label"><span class="full">Activit√©</span><span class="short">Act.</span></span>
          </button>
          <div class="step-line"></div>
          <button class="step" data-step="2" type="button">
            <span class="step-dot"></span><span class="step-label"><span class="full">Objectif</span><span class="short">Obj.</span></span>
          </button>
          <div class="step-line"></div>
          <button class="step" data-step="3" type="button">
            <span class="step-dot"></span><span class="step-label"><span class="full">Ajuster</span><span class="short">R√©gl.</span></span>
          </button>
        </div>
        <div class="step-meta" id="stepMeta">√âtape 1/4 ‚Äî 25% ‚Ä¢ Encore 3 √©tapes ‚Üí ton plan est pr√™t.</div>

        <!-- STEP 0: PROFIL -->
        <div class="card step-panel" data-panel="0" id="panelProfile">
          <div class="card-title">
            <h2>Profil</h2>
            <p class="muted">6 infos ‚Üí ton plan du jour. Rien de plus.</p>
          </div>

          <div class="grid2">
            <div class="field">
              <label class="label">Sexe <span class="info" data-tip="Le sexe influence le m√©tabolisme (formule BMR).">i</span></label>
              <div class="segmented" role="group" aria-label="Sexe" id="sexControl">
                <button type="button" class="seg" data-value="male">Homme</button>
                <button type="button" class="seg" data-value="female">Femme</button>
              </div>
              <div class="field-error" data-error-for="sex"></div>
            </div>

            <div class="field">
              <label class="label">√Çge <span class="info" data-tip="10‚Äì90 ans. Plus tu es jeune, plus la d√©pense de base est souvent √©lev√©e (√† poids √©gal).">i</span></label>
              <div class="number">
                <input inputmode="numeric" id="age" type="number" min="10" max="90" placeholder="22" />
                <span class="unit">ans</span>
              </div>
              <div class="field-error" data-error-for="age"></div>
            </div>

            <div class="field">
              <label class="label">Taille <span class="info" data-tip="120‚Äì220 cm. La taille impacte le BMR via la masse maigre estim√©e.">i</span></label>
              <div class="number">
                <input inputmode="numeric" id="height" type="number" min="120" max="220" placeholder="178" />
                <span class="unit">cm</span>
              </div>
              <div class="field-error" data-error-for="height"></div>
            </div>

            <div class="field">
              <label class="label">Poids <span class="info" data-tip="35‚Äì250 kg. Sert au BMR et aux macros (g/kg).">i</span></label>
              <div class="number">
                <input inputmode="decimal" id="weight" type="number" min="35" max="250" step="0.1" placeholder="89" />
                <span class="unit">kg</span>
              </div>
              <div class="field-error" data-error-for="weight"></div>
            </div>
          </div>

          <div class="hint">
            <span class="hint-dot"></span>
            <span>Astuce : vise des donn√©es r√©alistes. Le plan se met √† jour en direct.</span>
          </div>
        </div>

        <!-- STEP 1: ACTIVIT√â -->
        <div class="card step-panel hidden" data-panel="1" id="panelActivity">
          <div class="card-title">
            <h2>Activit√©</h2>
            <p class="muted">Choisis le niveau qui ressemble √† ta semaine r√©elle.</p>
          </div>

          <div class="options5" id="activityCards">
            <button class="option" type="button" data-factor="1.2">
              <div class="option-top">
                <div class="icon" aria-hidden="true">ü™ë</div>
                <div>
                  <div class="option-title">S√©dentaire</div>
                  <div class="option-sub">Bureau + peu de marche</div>
                </div>
              </div>
              <div class="option-meta">PAL ~ 1.20</div>
            </button>

            <button class="option" type="button" data-factor="1.35">
              <div class="option-top">
                <div class="icon" aria-hidden="true">üö∂</div>
                <div>
                  <div class="option-title">L√©ger</div>
                  <div class="option-sub">Marche + 1‚Äì2 s√©ances</div>
                </div>
              </div>
              <div class="option-meta">PAL ~ 1.35</div>
            </button>

            <button class="option" type="button" data-factor="1.5">
              <div class="option-top">
                <div class="icon" aria-hidden="true">üèÉ</div>
                <div>
                  <div class="option-title">Mod√©r√©</div>
                  <div class="option-sub">3‚Äì4 s√©ances / semaine</div>
                </div>
              </div>
              <div class="option-meta">PAL ~ 1.50</div>
            </button>

            <button class="option" type="button" data-factor="1.65">
              <div class="option-top">
                <div class="icon" aria-hidden="true">üèãÔ∏è</div>
                <div>
                  <div class="option-title">Actif</div>
                  <div class="option-sub">Sport + journ√©es dynamiques</div>
                </div>
              </div>
              <div class="option-meta">PAL ~ 1.65</div>
            </button>

            <button class="option" type="button" data-factor="1.8">
              <div class="option-top">
                <div class="icon" aria-hidden="true">üî•</div>
                <div>
                  <div class="option-title">Tr√®s actif</div>
                  <div class="option-sub">M√©tier physique + sport</div>
                </div>
              </div>
              <div class="option-meta">PAL ~ 1.80</div>
            </button>
          </div>

          <div class="field-error" data-error-for="activity"></div>
        </div>

        <!-- STEP 2: OBJECTIF -->
        <div class="card step-panel hidden" data-panel="2" id="panelGoal">
          <div class="card-title">
            <h2>Objectif</h2>
            <p class="muted">Un objectif clair ‚Üí un plan clair.</p>
          </div>

          <div class="options3" id="goalCards">
            <button class="option goal" type="button" data-goal="cut">
              <div class="option-top">
                <div class="icon" aria-hidden="true">‚úÇÔ∏è</div>
                <div>
                  <div class="option-title">S√®che</div>
                  <div class="option-sub">D√©ficit contr√¥l√©</div>
                </div>
              </div>
            </button>

            <button class="option goal" type="button" data-goal="maintain">
              <div class="option-top">
                <div class="icon" aria-hidden="true">üß≠</div>
                <div>
                  <div class="option-title">Maintien</div>
                  <div class="option-sub">Stabilit√© & performance</div>
                </div>
              </div>
            </button>

            <button class="option goal" type="button" data-goal="bulk">
              <div class="option-top">
                <div class="icon" aria-hidden="true">üß±</div>
                <div>
                  <div class="option-title">Prise de masse</div>
                  <div class="option-sub">Surplus intelligent</div>
                </div>
              </div>
            </button>
          </div>

          <div class="pace hidden" id="paceWrap">
            <div class="field">
              <label class="label">Rythme <span class="info" data-tip="Traduction en kcal/j : ~1100 kcal/j par 1.0 kg/semaine. Plus rapide = plus dur √† tenir.">i</span></label>
              <div class="slider-row">
                <input id="pace" type="range" min="0.10" max="1.00" step="0.05" value="0.50" />
                <div class="slider-value"><span id="paceValue">0.50</span> kg/sem</div>
              </div>
              <div class="muted small" id="paceHint"></div>
            </div>
          </div>

          <div class="field-error" data-error-for="goal"></div>
        </div>

        <!-- STEP 3: AJUSTER -->
        <div class="card step-panel hidden" data-panel="3" id="panelAdjust">
          <div class="card-title">
            <h2>Ajuster</h2>
            <p class="muted">Optionnel. En mode Simple, on garde des r√©glages intelligents.</p>
          </div>

          <div class="collapse" id="advancedCollapse">
            <button class="collapse-head" type="button" id="collapseBtn">
              <span>Ajuster les macros</span>
              <span class="chev" aria-hidden="true">‚ñæ</span>
            </button>

            <div class="collapse-body" id="collapseBody">
              <div class="grid2">
                <div class="field">
                  <label class="label">Profil glucides <span class="info" data-tip="Bas = plus lipides, moins glucides. √âlev√© = plus glucides, lipides au minimum.">i</span></label>
                  <div class="segmented" role="group" aria-label="Profil glucides" id="carbProfileControl">
                    <button type="button" class="seg" data-value="low">Bas</button>
                    <button type="button" class="seg" data-value="balanced">√âquilibr√©</button>
                    <button type="button" class="seg" data-value="high">√âlev√©</button>
                  </div>
                </div>

                <div class="field">
                  <label class="label">Prot√©ines <span class="info" data-tip="En g/kg. S√®che = plut√¥t haut. Prise de masse = suffisant, pas d√©lirant.">i</span></label>
                  <div class="number">
                    <input inputmode="decimal" id="proteinPerKg" type="number" step="0.1" min="1.2" max="3.0" />
                    <span class="unit">g/kg</span>
                  </div>
                </div>

                <div class="field">
                  <label class="label">Lipides min <span class="info" data-tip="Plancher sant√©/hormones. Trop bas = mauvais plan.">i</span></label>
                  <div class="number">
                    <input inputmode="decimal" id="fatMinPerKg" type="number" step="0.1" min="0.4" max="1.5" />
                    <span class="unit">g/kg</span>
                  </div>
                </div>

                <div class="field">
                  <label class="label">Glucides min <span class="info" data-tip="Garde-fou perf/humeur. Si tes calories sont trop basses, l'app baisse d'abord les lipides (jusqu'au min).">i</span></label>
                  <div class="number">
                    <input inputmode="decimal" id="carbMinPerKg" type="number" step="0.1" min="0" max="5.0" />
                    <span class="unit">g/kg</span>
                  </div>
                </div>

                <div class="field">
                  <label class="label">Fibres <span class="info" data-tip="Rep√®re simple : 25‚Äì35 g/j. Monte progressivement si tu es bas.">i</span></label>
                  <div class="number">
                    <input inputmode="numeric" id="fiber" type="number" step="1" min="10" max="60" />
                    <span class="unit">g/j</span>
                  </div>
                </div>

                <div class="field">
                  <label class="label">Eau <span class="info" data-tip="Base : ~30‚Äì40 ml/kg/j. Plus si sport/chaleur.">i</span></label>
                  <div class="number">
                    <input inputmode="decimal" id="water" type="number" step="0.1" min="1" max="8" />
                    <span class="unit">L/j</span>
                  </div>
                </div>

                <div class="field">
                  <label class="label">Sodium <span class="info" data-tip="Rep√®re : 2‚Äì3 g/j. Ajuste selon transpiration/activit√©.">i</span></label>
                  <div class="number">
                    <input inputmode="numeric" id="sodium" type="number" step="50" min="500" max="6000" />
                    <span class="unit">mg/j</span>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <div class="muted small">
            En mode Simple : on garde les valeurs recommand√©es automatiquement selon ton objectif et ton activit√©.
          </div>
        </div>

        <div class="actions">
          <button class="btn ghost" id="backBtn" type="button">Retour</button>
          <button class="btn primary" id="nextBtn" type="button">Suivant</button>
          <button class="btn subtle" id="resetBtn" type="button">R√©initialiser</button>
        </div>

        <div class="helper-row">
          <button class="link" type="button" id="startTourBtn">Visite guid√©e</button>
          <span class="muted small">‚Äî 15 secondes, puis termin√©.</span>
        </div>
      </section>

      <aside class="result" aria-label="R√©sultat">
        <div class="result-card card" id="resultCard">
          <div class="sheet-handle" id="sheetHandle" aria-hidden="true"></div>
          <div class="result-head">
            <div>
              <div class="eyebrow">Ta cible du jour</div>
              <div class="kcal">
                <span id="kcalValue">‚Äî</span>
                <span class="kcal-unit">kcal/j</span>
              </div>
            </div>
            <div class="coherence" aria-label="Score de coh√©rence">
              <button class="coh-btn" id="scoreBtn" type="button" title="Voir le d√©tail du score">
                <div class="coh-ring" id="cohRing">
                  <span id="cohValue">‚Äî</span>
                </div>
                <div class="coh-label">Coh√©rence</div>
              </button>

              <div class="score-popover" id="scorePopover" role="dialog" aria-label="D√©tails coh√©rence">
                <div class="score-pop-title" id="scoreHint">‚Äî</div>
                <div class="score-list" id="scoreList"></div>
              </div>
            </div>
          </div>

          <div class="chips" id="chips">
            <span class="chip neutral" id="chipTdee">TDEE ‚Äî</span>
            <span class="chip delta" id="chipDelta">Œî ‚Äî</span>
          </div>

          <div class="macros" id="macros">
            <div class="macro">
              <div class="macro-top">
                <span>Prot√©ines</span><span class="macro-metrics"><span class="macro-val" id="pVal">‚Äî g</span><span class="macro-pct" id="pPct">‚Äî%</span></span>
              </div>
              <div class="bar" data-t0="25" data-t1="35"><div class="band"></div><div class="fill" id="pBar"></div></div>
            </div>

            <div class="macro">
              <div class="macro-top">
                <span>Lipides</span><span class="macro-metrics"><span class="macro-val" id="fVal">‚Äî g</span><span class="macro-pct" id="fPct">‚Äî%</span></span>
              </div>
              <div class="bar" data-t0="25" data-t1="35"><div class="band"></div><div class="fill" id="fBar"></div></div>
            </div>

            <div class="macro">
              <div class="macro-top">
                <span>Glucides</span><span class="macro-metrics"><span class="macro-val" id="cVal">‚Äî g</span><span class="macro-pct" id="cPct">‚Äî%</span></span>
              </div>
              <div class="bar" data-t0="30" data-t1="50"><div class="band"></div><div class="fill" id="cBar"></div></div>
            </div>
          </div>

          <div class="todo">
            <div class="todo-head">
              <div>
                <div class="todo-title">√Ä faire aujourd‚Äôhui</div>
                <div class="todo-sub muted">Copie ‚Üí ex√©cute. Simple.</div>
              </div>
              <div class="todo-actions">
                <button class="btn small primary" type="button" id="copyPlanBtn">Copier</button>
                <button class="btn small" type="button" id="sharePlanBtn">Image</button>
              </div>
            </div>

            <div class="todo-list">
              <div class="todo-item"><span class="todo-check">‚úì</span><span class="todo-label">Calories</span><span class="todo-val" id="todoKcal">‚Äî</span></div>
              <div class="todo-item"><span class="todo-check">‚úì</span><span class="todo-label">Prot√©ines <span class="pill">priorit√©</span></span><span class="todo-val" id="todoP">‚Äî</span></div>
              <div class="todo-item"><span class="todo-check">‚úì</span><span class="todo-label">Eau</span><span class="todo-val" id="todoWater">‚Äî</span></div>
              <div class="todo-item"><span class="todo-check">‚úì</span><span class="todo-label">Fibres</span><span class="todo-val" id="todoFiber">‚Äî</span></div>
            </div>

            <div class="todo-foot">
              <button class="btn ghost small" type="button" id="setDailyBtn">D√©finir comme plan du jour</button>
            </div>
          </div>

          <div class="mini" id="miniTargets">
            <div class="mini-item"><span class="mini-ico" aria-hidden="true">üíß</span><span>Eau</span><span class="mini-val" id="waterVal">‚Äî</span></div>
            <div class="mini-item"><span class="mini-ico" aria-hidden="true">üåø</span><span>Fibres</span><span class="mini-val" id="fiberVal">‚Äî</span></div>
            <div class="mini-item"><span class="mini-ico" aria-hidden="true">üßÇ</span><span>Sodium</span><span class="mini-val" id="sodiumVal">‚Äî</span></div>
          </div>

          <div class="alerts" id="alerts"></div>

          <div class="legal alert">
            <div class="alert-ico" aria-hidden="true">‚ÑπÔ∏è</div>
            <div>
              <div class="alert-title">Info</div>
              <div class="alert-text">
                Estimation BMR/TDEE. Ajuste selon ton poids, ton √©nergie et ta faim.
                <button class="link" type="button" id="legalMore">En savoir plus</button>
              </div>
            </div>
          </div>

          <!-- mobile bottom-sheet handle -->
          <button class="sheet-toggle" id="sheetToggle" type="button" aria-label="Afficher les d√©tails">D√©tails</button>
        </div>
      </aside>
    </main>

    <footer class="footer">
      <div class="footer-left">
        <button class="btn small" id="exportBtn" type="button">Exporter JSON</button>
        <button class="btn small" id="importBtn" type="button">Importer JSON</button>
        <input type="file" id="importFile" accept="application/json" hidden />
      </div>
      <div class="footer-right muted small">¬© Nutrition-Track ‚Äî usage personnel</div>
    </footer>
  </div>

  <!-- Onboarding -->
  <div class="tour hidden" id="tour">
    <div class="tour-overlay" id="tourOverlay"></div>
    <div class="tour-bubble" id="tourBubble" role="dialog" aria-modal="true">
      <div class="tour-title" id="tourTitle">Bienvenue</div>
      <div class="tour-text" id="tourText"></div>
      <div class="tour-actions">
        <button class="btn small ghost" id="tourBack" type="button">Retour</button>
        <div class="tour-dots" id="tourDots"></div>
        <button class="btn small primary" id="tourNext" type="button">Suivant</button>
        <button class="btn small subtle" id="tourSkip" type="button">Fermer</button>
      </div>
    </div>
    <div class="tour-spot" id="tourSpot" aria-hidden="true"></div>
  </div>

  <script src="app.js"></script>

  <div class="toast" id="toast" role="status" aria-live="polite">
    <div class="toast-inner" id="toastText">‚Äî</div>
  </div>

  <div class="modal" id="legalModal" aria-hidden="true">
    <div class="modal-overlay" id="legalOverlay"></div>
    <div class="modal-card" role="dialog" aria-label="Informations">
      <div class="modal-head">
        <div class="modal-title">Information</div>
        <button class="icon-btn" type="button" id="legalClose" aria-label="Fermer">‚úï</button>
      </div>
      <div class="modal-body">
        <p><strong>Estimation.</strong> Les calculs utilisent des formules standards (BMR/TDEE). C‚Äôest une base de d√©part.</p>
        <p><strong>Ajuste.</strong> Suis ton poids (moyenne 7 jours), ton √©nergie, ta faim, tes perfs et ajuste la cible si besoin.</p>
        <p><strong>Consulte.</strong> En cas de pathologie, grossesse, traitement, ant√©c√©dent de TCA ou doute : demande l‚Äôavis d‚Äôun professionnel de sant√©.</p>
      </div>
      <div class="modal-foot">
        <button class="btn primary" type="button" id="legalOk">OK</button>
      </div>
    </div>
  </div>

</body>
</html>
